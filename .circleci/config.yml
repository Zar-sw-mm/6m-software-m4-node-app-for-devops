# version: 2.1
# orbs:
#   node: circleci/node@5.0.1
#   docker: circleci/docker@2.1.4
#   heroku: circleci/heroku@2.0.0
# jobs:
#   build:
#     docker:
#       - image: cimg/node:16.10
#     steps:
#       - checkout
#       - node/install-packages:
#           pkg-manager: npm
#       - run: |
#           echo "Installing dependencies..."
#           npm install
#   test:
#     docker:
#       - image: cimg/node:16.10
#     steps:
#       - checkout
#       - node/install-packages:
#           pkg-manager: npm
#       - run: |
#           echo "Running tests..."
#           npm run test

#   publish:
#     executor: docker/docker
#     steps:
#       - setup_remote_docker
#       - checkout
#       - docker/check:
#           docker-username: DOCKERHUB_LOGIN  # DOCKER_LOGIN is the default value, if it exists, it automatically would be used.
#           docker-password: DOCKERHUB_PASSWORD  # DOCKER_PASSWORD is the default value
#       - docker/build:
#           image: wongshennan/test_repository
#       - docker/push:
#           image: wongshennan/test_repository
#   deploy:
#     docker:
#       - image: cimg/node:16.10
#     steps:
#       - setup_remote_docker
#       - heroku/install
#       - checkout
#       - run:
#           name: Heroku Container Push
#           command: |
#               heroku container:login
#               heroku stack:set container -a shennan-su-devops
#               heroku container:push web -a shennan-su-devops
#               heroku container:release web -a shennan-su-devops

# workflows:
#   simple_workflow:
#     jobs:
#       - build
#       - test:
#           requires:
#             - build
#       - publish:
#           requires:
#             - test
#       - deploy:
#           requires:
#             - publish

version: 2.1
orbs:
  node: circleci/node@5.0.1
  docker: circleci/docker@2.1.4
# Each job has 2 parts - 1. Executor, 2. Steps
jobs:
  build:
    # executor:
    #   name: docker
    #   docker:
    #     - image: cimg/node:16.10
    # Means spin up a container using node:16.10 and run the steps
    # Shorthand for the executor
    docker:
      - image: cimg/node:16.10
    steps:
      - checkout
      # Using node/install-packages is better than npm install
      # because it gives you CircleCI optimization (caching, lockfile, concise)
      - node/install-packages:
          pkg-manager: npm
      # Without orbs, we have to run everything manually using run
      # - run: |
      #     echo "Installing dependencies"
      #     npm install
  lint:
    docker:
      - image: cimg/node:20.12
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
      - run: |
          echo "Running lint..."
          npm run lint
  test:
    docker:
      - image: cimg/node:16.10
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
      - run: |
          echo "Running tests..."
          npm run test
# Define the workflow for job execution order
workflows:
  simple_workflow:
    jobs:
      - build # Run build job first
      - lint: # Run lint job after build
          requires:
            - build
      - test: # Run test job after build
          requires:
            - build # test depends on build
